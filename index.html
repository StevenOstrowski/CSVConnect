async function init() {
    const statusBox = document.getElementById('status');
    try {
        api = await TrimbleConnectWorkspace.connect(
            window.parent,
            (event, args) => {
                console.log("Event received:", event, args);
                // Handle the menu click if Trimble sends a command
                if (event === "extension.command" && args.data === "show_main_ui") {
                    // This is where you'd show your UI if it was hidden
                }
                return true;
            },
            30000
        );

        // --- NEW CRITICAL SECTION FROM DOCS ---
        // This tells Trimble to actually draw the icon in the sidebar
        const menuObject = {
            title: "Sphere Loader",
            icon: "https://img.icons8.com/color/48/sphere.png",
            command: "show_main_ui"
        };
        
        await api.ui.setMenu(menuObject);
        // --------------------------------------

        statusBox.innerText = "✅ Connected & Menu Set!";
    } catch (e) {
        statusBox.innerText = "❌ Handshake Failed";
    }
}
